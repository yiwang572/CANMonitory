# 系统设置功能UI设计文档

## 1. 概述

本设计文档基于CANBusMonitor设计规范，详细描述BMS总线上位机软件中系统设置模块的用户界面设计，包括菜单栏、视图导航栏、工作区、属性面板和状态栏的布局、组件和交互设计。系统设置模块是BMS监控系统的基础组件，负责管理软件的全局配置、用户偏好、通信参数和系统维护等功能。

## 2. 整体布局

遵循设计文档中定义的三栏式布局架构，系统设置模块采用以下整体布局：

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                菜单栏 (系统设置相关菜单项)                      │
├─────────────┬───────────────────────────────────────┬─────────────────────────┤
│             │                                       │                         │
│             │                                       │                         │
│  导航视图    │             系统设置工作区               │     设置说明面板          │
│             │                                       │                         │
│             │                                       │                         │
└─────────────┴───────────────────────────────────────┴─────────────────────────┘
│                                状态栏                                           │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 3. 菜单栏设计

### 3.1 设置菜单（新增）

```
设置
├── 系统设置                   # 系统设置主菜单项
├── 用户首选项                 # 用户界面偏好设置
├── 通信设置                   # 通信参数配置
├── 外观设置                   # UI外观配置
├── ──────────
├── 恢复默认设置               # 恢复系统默认配置
├── 导入设置                   # 导入配置文件
└── 导出设置                   # 导出当前配置
```

- **系统设置**: 切换到系统设置主界面
- **用户首选项**: 打开用户界面偏好设置对话框
- **通信设置**: 打开通信参数配置对话框
- **外观设置**: 打开UI外观配置对话框
- **恢复默认设置**: 将所有设置恢复为默认值（需确认）
- **导入设置**: 从外部文件导入配置
- **导出设置**: 将当前配置导出到文件

### 3.2 工具菜单（扩展）

```
工具
├── 系统信息                   # 系统信息显示
├── 日志管理                   # 日志管理功能
├── 缓存清理                   # 清理临时文件缓存
├── 检查更新                   # 检查软件更新
├── ──────────
├── 许可证管理                 # 软件许可证管理
└── 技术支持                   # 技术支持信息
```

- **系统信息**: 显示软件和系统信息
- **日志管理**: 管理软件日志文件
- **缓存清理**: 清理临时文件和缓存
- **检查更新**: 检查软件是否有新版本
- **许可证管理**: 管理软件许可证
- **技术支持**: 显示技术支持联系方式和帮助文档

## 4. 视图导航栏设计

### 4.1 系统设置模块导航项

在左侧导航视图中，"系统设置"作为单独的功能模块项，图标采用设置相关的图形表示。

```
导航视图
├── 设备连接
├── 报文监控
├── 报文发送
├── DBC管理
├── OBD诊断
├── 自动化测试
└── 系统设置                   # 当前模块
    ├── 通用设置               # 子项
    ├── 通信设置               # 子项
    ├── 显示设置               # 子项
    ├── 日志设置               # 子项
    ├── 安全设置               # 子项
    └── 关于                   # 子项
```

- **通用设置**: 基本系统配置和用户偏好
- **通信设置**: CAN通信参数和协议配置
- **显示设置**: UI显示选项和外观配置
- **日志设置**: 日志记录和存储配置
- **安全设置**: 用户权限和安全相关配置
- **关于**: 软件版本信息和版权声明

### 4.2 导航交互

- 点击主项"系统设置"显示默认的通用设置界面
- 点击子项切换到对应的设置页面
- 当前选中的子项以高亮状态显示（使用主题色#0E4C92）
- 支持通过鼠标悬停显示功能提示
- 提供设置项的快速搜索功能

## 5. 工作区设计

工作区根据导航栏选择的子项动态切换内容，主要包括以下视图：

### 5.1 通用设置视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 操作按钮 ┌───────┐ ┌───────┐ ┌───────┐                         │ │
│          │保存设置│ │取消更改│ │应用设置│                         │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     通用设置选项组                                   │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 语言设置:                                                     │  │
│  │ [下拉选择: 中文简体, 英文, 日文]                                │  │
│  │                                                              │  │
│  │ 启动选项:                                                     │  │
│  │ [ ] 启动时自动加载上次会话                                     │  │
│  │ [ ] 启动时自动连接上次设备                                     │  │
│  │ [ ] 启动时显示欢迎界面                                         │  │
│  │                                                              │
│  │ 数据存储:                                                     │  │
│  │ 默认数据目录: [路径输入框] [浏览...]                            │  │
│  │ [ ] 自动清理超过30天的日志文件                                  │  │
│  │                                                              │  │
│  │ 时间格式:                                                     │  │
│  │ [单选: 24小时制, 12小时制]                                      │  │
│  │ 日期格式: [下拉选择: YYYY-MM-DD, MM/DD/YYYY, DD/MM/YYYY]        │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **操作按钮**: 提供保存、取消和应用设置的按钮
- **通用设置选项组**: 按类别组织的各种通用设置选项
- 支持语言、启动选项、数据存储路径和时间格式等配置
- 提供设置项的分组和折叠功能
- 支持实时预览某些设置的效果

### 5.2 通信设置视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 操作按钮 ┌───────┐ ┌───────┐ ┌───────┐                         │ │
│          │保存设置│ │取消更改│ │应用设置│                         │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     CAN通信设置                                     │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 通信设备:                                                     │  │
│  │ 默认设备: [下拉选择已检测的CAN设备]                             │  │
│  │                                                              │  │
│  │ 通信参数:                                                     │  │
│  │ 波特率: [下拉选择: 125k, 250k, 500k, 1M]                       │  │
│  │ 数据位: 8                                                     │  │
│  │ 校验位: None                                                  │  │
│  │ 停止位: 1                                                     │  │
│  │                                                              │
│  │ 通信超时:                                                     │  │
│  │ 连接超时: [输入框] 毫秒                                        │  │
│  │ 读写超时: [输入框] 毫秒                                        │  │
│  │ 重试次数: [输入框]                                            │  │
│  │                                                              │  │
│  │ 高级设置: [展开/折叠]                                          │  │
│  │ - 过滤器设置                                                  │  │
│  │ - 错误处理策略                                                │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **操作按钮**: 提供保存、取消和应用设置的按钮
- **CAN通信设置**: 配置CAN通信相关参数
- 支持设备选择、波特率设置和超时配置
- 提供高级设置的展开/折叠功能
- 支持通信参数的导入导出

### 5.3 显示设置视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 操作按钮 ┌───────┐ ┌───────┐ ┌───────┐                         │ │
│          │保存设置│ │取消更改│ │应用设置│                         │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     外观与显示选项                                   │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 主题设置:                                                     │  │
│  │ [下拉选择: 明亮主题, 暗黑主题, 蓝色主题]                          │  │
│  │ 预览: [主题预览区域]                                          │  │
│  │                                                              │
│  │ 字体设置:                                                     │  │
│  │ 界面字体: [下拉选择] 大小: [下拉选择]                           │  │
│  │ 等宽字体: [下拉选择] 大小: [下拉选择]                           │  │
│  │                                                              │
│  │ 布局设置:                                                     │  │
│  │ [ ] 自动隐藏菜单栏                                            │  │
│  │ [ ] 显示状态栏                                              │  │
│  │ [ ] 显示工具栏                                              │  │
│  │ 默认启动视图: [下拉选择]                                        │  │
│  │                                                              │
│  │ 颜色设置: [展开/折叠]                                          │  │
│  │ - 主色调选择                                                  │  │
│  │ - 状态颜色配置                                                │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **操作按钮**: 提供保存、取消和应用设置的按钮
- **外观与显示选项**: 配置界面外观和显示相关设置
- 支持主题切换、字体设置和布局配置
- 提供设置预览功能
- 支持自定义颜色配置

### 5.4 日志设置视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 操作按钮 ┌───────┐ ┌───────┐ ┌───────┐                         │ │
│          │保存设置│ │取消更改│ │应用设置│                         │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     日志记录配置                                     │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 日志级别:                                                     │  │
│  │ [下拉选择: 调试, 信息, 警告, 错误, 致命]                          │  │
│  │                                                              │
│  │ 日志存储:                                                     │  │
│  │ 日志文件路径: [路径输入框] [浏览...]                            │  │
│  │ 最大日志文件大小: [输入框] MB                                    │  │
│  │ 最大日志文件数量: [输入框]                                        │  │
│  │ [ ] 自动压缩超过30天的日志                                       │  │
│  │                                                              │
│  │ 日志内容:                                                     │  │
│  │ [ ] 记录CAN通信日志                                           │  │
│  │ [ ] 记录操作日志                                              │  │
│  │ [ ] 记录错误堆栈                                              │  │
│  │ [ ] 记录性能数据                                              │  │
│  │                                                              │
│  │ 日志格式:                                                     │  │
│  │ [单选: 文本格式, JSON格式, XML格式]                              │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **操作按钮**: 提供保存、取消和应用设置的按钮
- **日志记录配置**: 配置日志记录相关设置
- 支持日志级别、存储路径和文件管理设置
- 提供日志内容筛选选项
- 支持多种日志格式配置

### 5.5 安全设置视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 操作按钮 ┌───────┐ ┌───────┐ ┌───────┐                         │ │
│          │保存设置│ │取消更改│ │应用设置│                         │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     安全与访问控制                                   │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 用户认证:                                                     │  │
│  │ [ ] 启动时需要密码验证                                          │  │
│  │ [ ] 自动锁定（分钟）: [输入框]                                   │  │
│  │                                                              │
│  │ 密码设置: [修改密码...]                                         │  │
│  │                                                              │
│  │ 访问控制:                                                     │  │
│  │ 当前用户: [用户名]                                             │  │
│  │ 用户级别: [下拉选择: 管理员, 操作员, 只读用户]                     │  │
│  │                                                              │
│  │ 数据安全:                                                     │  │
│  │ [ ] 导出数据时加密                                             │  │
│  │ [ ] 诊断日志加密存储                                           │  │
│  │                                                              │
│  │ 高级安全选项: [展开/折叠]                                        │  │
│  │ - 权限管理                                                    │  │
│  │ - 安全审计                                                    │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **操作按钮**: 提供保存、取消和应用设置的按钮
- **安全与访问控制**: 配置安全相关设置
- 支持用户认证、密码设置和访问控制
- 提供数据安全选项
- 支持高级安全功能的展开/折叠

### 5.6 关于视图

```
┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│                     软件信息与支持                                   │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 软件Logo和名称                                                │  │
│  │                                                              │
│  │ 版本信息:                                                     │  │
│  │ BMS总线上位机软件 v2.0.1                                      │  │
│  │ 构建号: 20240101-001                                           │  │
│  │ 发布日期: 2024-01-01                                           │  │
│  │                                                              │
│  │ 版权信息:                                                     │  │
│  │ © 2024 BMS Tech Co., Ltd. 保留所有权利。                          │  │
│  │                                                              │
│  │ 法律声明:                                                     │  │
│  │ 本软件受著作权法保护...                                         │  │
│  │                                                              │
│  │ 支持与服务:                                                   │  │
│  │ 网站: [链接] https://www.bmstech.com                           │  │
│  │ 邮箱: support@bmstech.com                                     │  │
│  │ 电话: 400-888-8888                                            │  │
│  │                                                              │
│  │ [检查更新] [查看许可证] [阅读文档]                              │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **软件信息与支持**: 显示软件版本、版权和支持信息
- 提供软件版本号、构建号和发布日期
- 显示版权信息和法律声明
- 提供技术支持联系方式和链接
- 包含检查更新、查看许可证和阅读文档的按钮

## 6. 属性面板设计

右侧属性面板在系统设置模块中主要用于显示当前选中设置项的说明和帮助信息：

### 6.1 设置项说明面板

当在工作区中选中某个设置项时，属性面板显示：

```
设置项说明
├── 名称: 启动时自动加载上次会话
├── 描述: 勾选此选项后，软件启动时将自动恢复上次关闭时的工作状态，包括打开的视图、连接的设备和加载的数据文件
├── 影响范围: 软件启动行为
├── 默认值: 启用
├── 相关设置: [相关设置项链接]
└────────────────

提示信息:
启用此功能可以提高工作效率，但在某些情况下可能会延长启动时间，特别是上次关闭时打开了大量数据文件或视图
```

- **名称**: 当前设置项的名称
- **描述**: 设置项的详细描述和功能说明
- **影响范围**: 说明此设置会影响系统的哪些方面
- **默认值**: 显示设置项的默认值
- **相关设置**: 链接到相关的其他设置项
- **提示信息**: 提供使用建议和注意事项

### 6.2 设置分组信息

当选中设置分组时，显示分组信息：

```
设置分组信息
├── 分组名称: 通信设置
├── 包含项目: 12个设置项
├── 说明: 管理软件与CAN设备的通信参数和协议配置
├── 推荐配置: 对于标准CAN总线，建议使用500k波特率
└────────────────

应用提示:
修改通信参数后，需要重新连接设备才能使设置生效
```

- **分组名称**: 当前设置分组的名称
- **包含项目**: 分组内包含的设置项数量
- **说明**: 分组功能的简要说明
- **推荐配置**: 提供推荐的配置参数
- **应用提示**: 提供设置应用的相关提示

## 7. 状态栏设计

底部状态栏在系统设置模块中显示与设置操作相关的状态信息：

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 设置状态: 已保存 | 当前页面: 通用设置 | 上次保存: 2024-01-20 15:30:25 | 版本: v2.0.1  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

- **设置状态**: 显示当前设置的保存状态（已保存/未保存/应用中）
- **当前页面**: 显示当前查看的设置页面名称
- **上次保存**: 显示最近一次保存设置的时间
- **版本**: 显示软件版本号
- 应用设置时显示进度条
- 显示设置操作的成功或错误消息
- 显示系统资源使用状态（内存、CPU等）

## 8. 交互设计

### 8.1 设置修改流程

1. **设置修改与保存流程**:
   - 在设置页面中修改参数
   - 点击"应用设置"按钮立即应用但不保存
   - 点击"保存设置"按钮保存并应用所有修改
   - 点击"取消更改"按钮放弃所有未保存的修改
   - 未保存修改时关闭页面会提示保存

2. **设置导入导出流程**:
   - 点击"导入设置"按钮，选择配置文件
   - 系统解析配置文件并应用设置
   - 点击"导出设置"按钮，选择保存路径
   - 系统将当前配置导出为文件

3. **恢复默认设置流程**:
   - 点击"恢复默认设置"菜单项
   - 显示确认对话框，说明操作影响
   - 确认后，系统将所有设置恢复为出厂默认值
   - 提示用户重启软件以应用全部默认设置

### 8.2 上下文菜单

为设置项和分组提供右键上下文菜单：

```
设置项右键菜单
├── 重置为默认值
├── 复制当前值
├── 粘贴值
├── 查看说明
└── 搜索相关帮助
```

```
设置分组右键菜单
├── 展开所有
├── 折叠所有
├── 重置此组为默认值
├── 导出此组设置
└── 导入此组设置
```

### 8.3 键盘快捷键

提供常用设置操作的键盘快捷键：

- **Ctrl+S**: 保存设置
- **Ctrl+R**: 恢复默认设置
- **Ctrl+I**: 导入设置
- **Ctrl+E**: 导出设置
- **Tab/Shift+Tab**: 在设置项间导航
- **Enter**: 应用当前设置或打开下拉菜单
- **F1**: 显示当前设置项的帮助信息

## 9. 视觉设计规范

### 9.1 颜色方案

遵循设计文档中定义的整体配色方案，并为系统设置功能添加特定颜色：

- **主色调**: #0E4C92 (深蓝)
- **中性色**: #F8F9FA (浅灰背景), #343A40 (深灰文字)
- **设置状态颜色**:
  - 默认值: #95A5A6 (灰色系)
  - 已修改未保存: #FFCE56 (黄色系)
  - 已保存: #4ECDC4 (绿色系)
  - 警告设置: #FF9F43 (橙色系)
  - 错误设置: #FF6B6B (红色系)
- **设置分组**: 使用不同的背景色或边框区分设置分组

### 9.2 字体与布局

- **字体**: 微软雅黑，清晰易读
- **设置项标签**: 使用稍大字体或粗体，突出重要性
- **控件布局**: 采用两列布局，左侧标签，右侧控件
- **间距**: 适当增大设置组之间的间距，提高可读性
- **分组**: 使用分组框和分隔线清晰划分设置区域
- **操作按钮**: 主要操作按钮（如保存）使用醒目的颜色

### 9.3 图标设计

- 使用直观的图标表示不同类别的设置项
- 为重要设置提供警告或提示图标
- 使用统一风格的开关、复选框和单选按钮
- 为设置页面提供面包屑导航
- 使用工具提示图标表示有额外说明的设置项

## 10. 响应式设计

### 10.1 窗口缩放

- 界面元素支持窗口缩放自动调整大小
- 当窗口变窄时，设置项布局自动调整为单列
- 支持设置页面的滚动和分页
- 确保在小屏幕设备上关键设置项仍然可见

### 10.2 多显示器支持

- 支持设置对话框在多显示器间拖动
- 记住设置窗口的位置和大小
- 支持设置页面的最大化和最小化
- 提供设置页面的独立显示模式

## 11. 性能优化

### 11.1 设置加载优化

- 实现设置的懒加载，仅在需要时加载相关设置
- 使用缓存机制减少设置读取次数
- 优化大型设置文件的解析和应用
- 提供设置加载和应用的进度指示

### 11.2 用户界面响应性

- 设置保存操作在后台线程执行，避免UI卡顿
- 实时验证设置值的有效性，提供即时反馈
- 实现设置变更的批量应用，减少重复操作
- 提供设置自动保存选项，避免意外丢失

## 12. 无障碍设计

### 12.1 键盘导航

- 支持全键盘操作，包括菜单访问、设置项导航等
- 提供快捷键支持常用设置操作
- 实现焦点指示器，清晰显示当前操作元素
- 支持设置页面的Tab键导航顺序自定义

### 12.2 屏幕阅读器支持

- 为所有UI元素提供适当的访问性名称和描述
- 支持屏幕阅读器正确读取设置项和说明
- 确保颜色区分不依赖于颜色识别（提供额外的形状或标记）
- 提供设置向导和提示信息的文本描述

---

**文档版本**: 1.0
**创建日期**: 2024-01-01
**最后更新**: 2024-01-01
**文档作者**: UI设计团队