# DBC管理功能UI设计文档

## 1. 概述

本设计文档基于BMS监控系统需求规格说明，详细描述DBC管理模块的用户界面设计。该模块负责DBC文件的导入、导出、编辑和使用，为CAN网络通信提供必要的配置支持。

- **文档依据**：BMS监控系统需求规格说明
- **模块功能**：提供DBC文件管理、编辑、验证和应用功能
- **设计原则**：界面直观易用，支持复杂编辑操作，确保数据一致性

## 2. 整体布局

整体布局采用经典的桌面应用程序界面结构，遵循统一的设计规范，确保各模块之间的视觉一致性。

```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ 菜单栏：文件 编辑 视图 工具 帮助                                                                           │
├──────────────┬────────────────────────────────────────────────────────────────────────────────────────────┤
│              │                                                                                            │
│ 视图导航栏   │                                          工作区                                                │
│ （左侧）     │                                          （中央）                                                │
│              │                                                                                            │
│              │                                                                                            │
├──────────────┼────────────────────────────────────────────────────────────────────────────────────────────┤
│              │                                          属性面板                                              │
│              │                                          （右侧/底部）                                            │
│              │                                                                                            │
├──────────────┴────────────────────────────────────────────────────────────────────────────────────────────┤
│ 状态栏：显示DBC文件状态、选中项信息、系统提示等                                                           │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

- **菜单栏**：位于顶部，提供全局操作入口，包括文件、编辑、视图、工具和帮助等菜单
- **导航栏**：位于左侧，用于切换不同功能模块，显示当前选中模块的子项
- **工作区**：位于中央，显示当前功能模块的核心内容，是用户主要交互区域
- **属性面板**：位于底部或右侧，显示和编辑当前选中项的详细属性
- **状态栏**：位于底部，显示系统状态信息，如DBC文件状态、选中项信息和系统提示等

## 3. 菜单栏设计

菜单栏位于界面顶部，提供DBC文件和模块功能的主要操作入口，采用标准的下拉菜单形式。

```
文件
  ├── 新建 (Ctrl+N)
  ├── 打开 (Ctrl+O)
  ├── 保存 (Ctrl+S)
  ├── 另存为 (Ctrl+Shift+S)
  ├── 导入 (Ctrl+I)
  ├── 导出 (Ctrl+E)
  ├── ────────────────────
  ├── 最近文件
  │     ├── DBC1.dbc
  │     ├── DBC2.dbc
  │     └── DBC3.dbc
  └── 退出 (Alt+F4)

编辑
  ├── 撤销 (Ctrl+Z)
  ├── 重做 (Ctrl+Y)
  ├── ────────────────────
  ├── 剪切 (Ctrl+X)
  ├── 复制 (Ctrl+C)
  ├── 粘贴 (Ctrl+V)
  ├── 删除 (Delete)
  ├── ────────────────────
  ├── 查找 (Ctrl+F)
  ├── 替换 (Ctrl+H)
  └── 全选 (Ctrl+A)

视图
  ├── 刷新 (F5)
  ├── ────────────────────
  ├── 显示/隐藏导航栏 (Ctrl+B)
  ├── 显示/隐藏属性面板 (Ctrl+P)
  ├── 显示/隐藏状态栏 (Ctrl+T)
  ├── 工具栏 (Ctrl+L)
  └── 视图设置

工具
  ├── DBC验证器
  ├── DBC比较器
  ├── 信号计算器
  ├── 消息仿真器
  ├── 批量导入/导出
  └── 选项

帮助
  ├── 帮助主题 (F1)
  ├── 使用教程
  └── 关于
```


## 4. 视图导航栏设计

视图导航栏位于界面左侧，用于切换DBC管理模块内的不同功能视图，采用树形结构显示。

### 4.1 导航视图结构

```
导航视图
├── 设备连接
├── 报文监控
├── 报文发送
├── DBC管理                    # 当前模块
│   ├── DBC文件管理            # 子项
│   ├── 信号编辑器            # 子项
│   ├── 模板库                # 子项
│   └── 配置导入导出          # 子项
├── OBD诊断
├── 自动化测试
└── 系统设置
```

- **DBC文件管理**: 显示已加载的DBC文件列表，提供文件级操作
- **信号编辑器**: 提供信号级编辑功能，可拖拽配置信号显示
- **模板库**: 预定义的BMS信号模板集合
- **配置导入导出**: DBC配置的导入导出功能

### 4.2 导航样式规范

- **图标**: 每个导航项左侧显示对应的图标，例如DBC文件使用📄图标，信号编辑器使用📊图标等
- **文字**: 使用微软雅黑字体，14px，黑色，选中项文字加粗显示
- **背景色**: 普通状态为白色(#FFFFFF)，选中状态为浅蓝色(#E6F7FF)，悬停状态为浅灰色(#F5F5F5)
- **边框**: 选中项右侧显示蓝色竖线作为选中标记

### 4.3 导航交互

- **点击**：点击导航项可切换对应的工作区视图
- **选中高亮**：当前选中的子项以高亮状态显示（使用主题色#0E4C92）
- **展开/折叠**：支持子项的展开和折叠操作
- **拖拽**：支持导航项的拖拽排序（如需）
- **提示**：支持通过鼠标悬停显示功能提示

## 5. 工作区设计

工作区位于界面中央，根据导航栏选择的不同视图动态显示相应内容。DBC管理模块包含以下主要视图：

### 5.1 DBC文件管理视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 文件操作工具栏 ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ │
│                │加载DBC│ │导出DBC│ │验证DBC│ │移除DBC│ │设置默认│ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     DBC文件列表区域                               │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 文件名       │ 节点数  │ 消息数  │ 信号数  │ 加载状态  │ 默认 │  │
│  ├─────────────────────────────────────────────────────────────┤  │
│  │ BMS_v1.dbc   │ 12     │ 48     │ 320    │ 已加载   │  √  │  │
│  │ BMS_ext.dbc  │ 5      │ 23     │ 145    │ 已加载   │     │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     消息预览表格区域                               │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ ID      │ 名称        │ DLC  │ 发送节点  │ 信号数量  │ 操作  │  │
│  ├─────────────────────────────────────────────────────────────┤  │
│  │ 0x180   │ BMS_Status  │ 8    │ BMS_Ctrl │ 8        │ 编辑  │  │
│  │ 0x181   │ BMS_CellV   │ 8    │ BMS_Ctrl │ 6        │ 编辑  │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **文件操作工具栏**: 提供常用的DBC文件操作按钮
- **DBC文件列表**: 显示已加载的DBC文件，包含基本统计信息
- **设置默认**: 设为默认DBC文件，用于报文解码优先选择
- **消息预览表格**: 显示当前选中DBC文件中的消息列表

### 5.2 信号编辑器视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 消息选择器 ┌───────────────────────────────────────────────────┐ │
│            │ BMS_Status (0x180)                                 │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     信号编辑表格区域                               │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 名称      │ 起始位 │ 长度 │ 因子 │ 偏移 │ 最小值 │ 最大值 │ 单位 │  │
│  ├─────────────────────────────────────────────────────────────┤  │
│  │ SOC       │ 0      │ 16   │ 0.1  │ 0    │ 0      │ 100    │ %   │  │
│  │ SOH       │ 16     │ 8    │ 1    │ 0    │ 0      │ 100    │ %   │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     信号可视化编辑区域                             │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │                                                             │  │
│  │           8字节数据位可视化编辑图(可拖拽调整信号位)           │  │
│  │                                                             │  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **消息选择器**: 下拉列表选择要编辑的消息
- **信号编辑表格**: 显示和编辑当前消息包含的所有信号属性
- **信号可视化编辑区域**: 图形化显示消息的数据位分配，支持拖拽调整信号的起始位和长度

### 5.3 模板库视图

```
┌───────────────────────────────────────────────────────────────────┐
│ 模板分类 ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌───────┐ │
│          │电池电压 │ │电池温度 │ │故障诊断 │ │充电控制 │ │...    │ │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│                     信号模板列表区域                               │
│  ┌─────────────────────────────────────────────────────────────┐  │
│  │ 模板名称    │ 类型    │ 长度  │ 因子  │ 偏移 │ 单位 │ 描述  │  │
│  ├─────────────────────────────────────────────────────────────┤  │
│  │ 单体电压    │ 有符号  │ 12    │ 0.001 │ 0    │ V    │ 电芯电压│  │
│  │ 温度探头    │ 有符号  │ 10    │ 0.1   │ -40  │ °C   │ 温度传感器│  │
│  └─────────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

- **模板分类**: 按功能对信号模板进行分类，便于快速查找
- **信号模板列表**: 显示预定义的BMS常用信号模板，可直接应用到DBC编辑中

## 6. 属性面板设计

右侧属性面板根据工作区当前选中的对象动态显示相应属性：

### 6.1 DBC文件属性

当在DBC文件列表中选中一个文件时，属性面板显示：

```
DBC文件属性
├── 文件名: BMS_v1.dbc
├── 文件路径: C:\DBC\BMS_v1.dbc
├── 创建时间: 2024-01-01 10:30:00
├── 最后修改: 2024-01-15 14:20:00
├── 节点数量: 12
├── 消息数量: 48
├── 信号数量: 320
├── 版本信息: 1.0
└── 描述信息: 标准BMS通信协议DBC文件
```

### 6.2 消息属性

当选中某个消息时，属性面板显示：

```
消息属性
├── 消息ID: 0x180
├── 消息名称: BMS_Status
├── 扩展帧: 否
├── DLC: 8
├── 发送节点: BMS_Ctrl
├── 周期: 100ms
├── 注释: BMS状态信息
└── 传输类型: 周期
```

### 6.3 信号属性

当选中某个信号时，属性面板显示：

```
信号属性
├── 信号名称: SOC
├── 所属消息: BMS_Status (0x180)
├── 起始位: 0
├── 长度: 16
├── 字节顺序: 小端
├── 数据类型: 无符号
├── 因子: 0.1
├── 偏移: 0
├── 最小值: 0
├── 最大值: 100
├── 单位: %
├── 接收节点: VCU, DISPLAY
└── 注释: 电池荷电状态
```

### 6.4 属性编辑功能

- 所有属性支持直接编辑（除只读属性外）
- 修改属性后实时更新到DBC数据结构
- 提供属性验证，防止输入错误
- 支持通过下拉列表选择常用值

## 7. 状态栏设计

底部状态栏显示与DBC管理相关的状态信息：

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ DBC文件: BMS_v1.dbc (48消息, 320信号) | 当前选中: 信号 SOC | 状态: 已加载 | 编码: UTF-8 |
└─────────────────────────────────────────────────────────────────────────────────┘
```

- **DBC文件**: 显示当前活动的DBC文件名及其包含的消息和信号数量
- **当前选中**: 显示当前选中的元素类型和名称
- **状态**: 显示DBC文件的加载状态
- **编码**: 显示DBC文件的字符编码格式
- 支持显示操作进度条（如在加载大型DBC文件时）
- 支持显示错误和警告信息（如DBC解析错误）

## 8. 交互设计

### 8.1 DBC文件操作流程

1. **加载DBC文件**:
   - 点击"加载DBC文件"按钮或菜单
   - 弹出文件选择对话框，支持多选
   - 显示加载进度条
   - 加载完成后在文件列表中显示，并自动解析消息和信号

2. **DBC文件验证**:
   - 选中DBC文件，点击"验证DBC"按钮
   - 系统执行格式验证
   - 在状态栏显示验证结果
   - 如有错误，显示错误列表和定位信息

3. **信号编辑**:
   - 在消息预览表格中选择消息
   - 在信号编辑表格中修改信号属性
   - 或在可视化编辑区域拖拽调整信号位
   - 修改实时生效，并在状态栏显示变更提示

### 8.2 上下文菜单

为DBC文件列表和消息/信号表格提供右键上下文菜单：

```
DBC文件右键菜单
├── 加载
├── 卸载
├── 设置为默认
├── 导出
├── 验证
├── 重命名
└── 删除
```

```
消息/信号右键菜单
├── 编辑
├── 复制
├── 粘贴
├── 添加新项
├── 删除
└── 查看详情
```

### 8.3 拖放操作

- 支持从文件资源管理器拖拽DBC文件到软件窗口进行加载
- 支持在信号编辑器中拖拽调整信号位分配
- 支持从模板库拖拽模板到信号编辑表格应用

## 9. 视觉设计规范

### 9.1 颜色方案

遵循设计文档中定义的整体配色方案：

- **主色调**: #0E4C92 (深蓝)
- **中性色**: #F8F9FA (浅灰背景), #343A40 (深灰文字)
- **强调色**: #FF6B6B (错误/警告), #4ECDC4 (成功/信息), #45B7D1 (高亮)
- **信号编码色**: 使用不同颜色区分信号类型（电压、电流、温度等）

### 9.2 字体与布局

- **字体**: 微软雅黑，清晰易读
- **表格行高**: 适中，支持密集和舒适两种显示模式
- **控件间距**: 保持一致，提供良好的视觉层次
- **分组**: 使用分组框和分隔线清晰划分功能区域

### 9.3 图标设计

- 使用直观的图标表示各种操作（加载、保存、验证等）
- 为不同类型的信号提供区分性图标
- 图标风格统一，符合整体UI设计

## 10. 响应式设计

### 10.1 窗口缩放

- 界面元素支持窗口缩放自动调整大小
- 表格列宽可调整，并支持自动适应内容
- 在小屏幕上可折叠导航栏，扩大工作区空间

### 10.2 多标签管理

- 支持多DBC文件和编辑界面的标签页管理
- 标签页可拖拽排序和分离
- 提供标签页固定功能，防止误关闭

## 11. 性能优化

### 11.1 大数据量处理

- 对大型DBC文件（包含大量消息和信号）采用虚拟列表显示
- 实现增量加载和延迟解析机制
- 优化信号解码算法，保证实时性能

### 11.2 缓存机制

- 缓存已解析的DBC文件数据结构
- 提供内存使用状态显示
- 支持手动清理缓存

## 12. 无障碍设计

### 12.1 键盘导航

- 支持全键盘操作，包括菜单访问、表格导航等
- 提供快捷键支持常用操作
- 实现焦点指示器，清晰显示当前操作元素

### 12.2 屏幕阅读器支持

- 为所有UI元素提供适当的访问性名称和描述
- 支持屏幕阅读器正确读取表格内容和属性面板
- 确保颜色区分不依赖于颜色识别（提供额外的形状或标记）

---

**文档版本**: 1.0
**创建日期**: 2024-01-01
**最后更新**: 2024-01-01
**文档作者**: UI设计团队