# 设备连接功能UI设计文档

## 1. 概述

本设计文档基于BMS监控系统需求规格说明，详细描述设备连接模块的用户界面设计。该模块负责建立和管理与电池管理系统(BMS)的通信连接，允许用户选择、配置和监控与物理设备的连接状态，支持多种通信协议和接口类型。

- **文档依据**：BMS监控系统需求规格说明
- **模块功能**：提供设备发现、连接配置、状态监控和管理功能
- **设计原则**：界面简洁直观，操作流程清晰，实时反馈连接状态

## 2. 整体布局

整体布局采用经典的桌面应用程序界面结构，遵循统一的设计规范，确保各模块之间的视觉一致性。

```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ 菜单栏：文件 编辑 视图 工具 帮助                                                                           │
├──────────────┬────────────────────────────────────────────────────────────────────────────────────────────┤
│              │                                                                                            │
│              │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│              │  │                                                                                      │  │
│              │  │           工作区：根据所选功能模块显示不同内容                                         │  │
│              │  │                                                                                      │  │
│ 视图导航栏   │  │                                                                                      │  │
│              │  │                                                                                      │  │
│ （功能模块列表）│  └──────────────────────────────────────────────────────────────────────────────────────┘  │
│              │                                                                                            │
│              │  ┌──────────────────────────────────────────────────────────────────────────────────────┐  │
│              │  │  属性面板：显示/编辑当前选中项的详细属性                                                │  │
│              │  │                                                                                      │  │
│              │  └──────────────────────────────────────────────────────────────────────────────────────┘  │
├──────────────┴────────────────────────────────────────────────────────────────────────────────────────────┤
│ 状态栏：显示连接状态、设备信息、系统提示等                                                                │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

- **菜单栏**：位于顶部，提供全局操作入口，包括文件、编辑、视图、工具和帮助等菜单
- **导航栏**：位于左侧，用于切换不同功能模块，显示当前选中模块的子项
- **工作区**：位于中央，显示当前功能模块的核心内容，是用户主要交互区域
- **属性面板**：位于底部或右侧，显示和编辑当前选中项的详细属性
- **状态栏**：位于底部，显示系统状态信息，如连接状态、设备信息和系统提示等

遵循设计文档中定义的三栏式布局架构，设备连接模块采用与主程序一致的布局结构。

## 3. 菜单栏设计

菜单栏位于界面顶部，提供全局操作入口，设备连接模块相关的菜单功能如下：

```
文件
├── 新建连接            (Ctrl+N)
├── 打开连接配置        (Ctrl+O)
├── 保存连接配置        (Ctrl+S)
├── 保存连接配置为...   (Ctrl+Shift+S)
├── ──────────
├── 连接设备            (Ctrl+Shift+C)
├── 断开连接            (Ctrl+Shift+D)
├── 最近连接
│   ├── USBCANFD-200 #1 (125k)
│   ├── USBCANFD-200 #1 (500k)
│   └── USBCAN-II #2 (1M)
├── ──────────
└── 退出               (Alt+F4)

设备
├── 设备管理
├── 通道设置
├── 通信设置
├── ──────────
└── 固件更新

视图
├── 刷新视图           (F5)
├── 设备连接面板
├── 属性面板
└── 状态栏

工具
├── 连接管理器
├── 设备搜索           (Ctrl+F)
├── 连接诊断
└── 配置编辑器

帮助
├── 帮助主题           (F1)
└── 关于
```
- **状态栏**: 显示/隐藏底部状态栏

## 4. 视图导航栏设计

视图导航栏位于界面左侧，用于切换设备连接模块下的不同功能视图：

### 4.1 导航视图结构

```
设备连接
├── 最近连接
├── 设备管理
├── 硬件信息
└── 配置模板
```

### 4.2 导航样式规范

- **图标**：📶 USB-CAN设备图标
- **文字**：采用12px微软雅黑，左侧图标与文字间距8px
- **背景色**：未选中项浅灰(#F8F9FA)，选中项主色调(#0E4C92)
- **文字色**：未选中项深灰(#343A40)，选中项白色
- **边框**：选中项左侧显示3px蓝色边框
- **高度**：每个导航项高度36px

### 4.3 导航交互

- **点击切换**：点击主项"设备连接"显示默认的设备列表和连接界面，点击子项切换到对应的功能视图
- **高亮显示**：当前选中的子项以高亮状态显示（使用主题色#0E4C92），字体加粗
- **键盘导航**：支持通过键盘方向键在导航项间切换
- **悬停效果**：鼠标悬停时背景色加深10%
- **右键菜单**：支持在导航项上右键打开上下文菜单，提供额外操作选项
- **功能提示**：支持通过鼠标悬停显示功能提示
- **快速搜索**：提供设备快速搜索功能

## 5. 工作区设计

工作区根据导航栏选择的子项动态显示不同的内容，提供直观的设备管理界面：

### 5.1 设备列表视图

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    设备连接 - 设备列表                                           │
├──────────────────────────────────────┬─────────────────────────────────────────────────────────┤
│ 可用设备列表                          │                          设备详情                        │
│ ┌──────────────────────────────────┐ │ ┌─────────────────────────────────────────────────────┐ │
│ │ 设备名称       │ 类型      │ 状态  │ │ │ 设备信息                                            │ │
│ │──────────────────────────────────│ │ │ 名称: USBCANFD-200 #1                               │ │
│ │ USBCANFD-200 #1 │ USB-CAN  │ 已连接│ │ │ 型号: USBCANFD-200                                  │ │
│ │ USBCAN-II #2    │ USB-CAN  │ 可用  │ │ │ 序列号: SN12345678                                  │ │
│ │ 虚拟CAN #1      │ 虚拟设备 │ 可用  │ │ │ 固件版本: V1.0.3                                    │ │
│ └──────────────────────────────────┘ │ │ 通信参数                                            │ │
│                                      │ │ 波特率: 500Kbps                                      │ │
│ ┌──────────────────────────────────┐ │ │ 采样点: 75%                                          │ │
│ │ [ 搜索设备 ]  [ 刷新列表 ]      │ │ │ 通道: CH1                                           │ │
│ └──────────────────────────────────┘ │ │ 连接状态: 已连接                                     │ │
│                                      │ │ 连接时间: 2023-11-15 14:30:45                        │ │
│ 通道配置                             │ │ ┌─────────────────────────────────────────────────┐ │ │
│ ┌──────────────────────────────────┐ │ │ │ [ 断开连接 ] [ 配置通道 ] [ 设备诊断 ]       │ │ │
│ │ 波特率: [500Kbps ▼]              │ │ │ └─────────────────────────────────────────────────┘ │ │
│ │ 采样点: [75% ▼]                   │ │ └─────────────────────────────────────────────────────┘ │
│ │ 过滤器: [关闭 ▼]                  │ │                                                         │
│ │ [ 应用设置 ]                      │ │                                                         │
│ └──────────────────────────────────┘ │                                                         │
└──────────────────────────────────────┴─────────────────────────────────────────────────────────┘
```

- **可用设备列表**：
  - 表格形式展示所有检测到的设备
  - 显示设备名称、类型、状态等基本信息
  - 支持单选和多选操作

- **设备详情面板**：
  - 显示选中设备的详细信息（型号、序列号、固件版本等）
  - 展示当前连接状态和通信参数
  - 提供连接/断开、通道配置和设备诊断按钮

- **通道配置区域**：
  - 配置波特率、采样点、过滤器等通信参数
  - 提供应用设置按钮实时更新参数

### 5.2 连接配置视图

连接配置视图用于管理和编辑连接配置文件：

- **配置文件管理**：
  - 列表展示所有已保存的配置文件
  - 支持新建、编辑、删除、导入和导出配置

- **配置参数编辑**：
  - 设备信息配置
  - 通信参数设置（波特率、采样点、过滤器等）
  - 高级参数配置（超时设置、重试次数等）

- **配置验证**：
  - 实时验证配置参数的有效性
  - 提供配置测试功能

### 5.3 连接历史视图

连接历史视图记录并展示设备连接的历史记录：

- **历史记录列表**：
  - 表格形式展示连接历史
  - 包含设备名称、连接时间、断开时间、持续时长、连接状态等信息

- **筛选和搜索**：
  - 按时间范围筛选
  - 按设备名称搜索
  - 按连接状态筛选

- **导出功能**：
  - 导出历史记录到Excel或CSV文件
  - 支持打印功能

### 5.4 设备诊断视图

设备诊断视图提供设备状态检测和问题排查功能：

- **诊断项目**：
  - 设备自检（硬件状态检查）
  - 通信测试（信号强度、误码率等）
  - 固件检查（版本、更新状态）
  - 通道测试（收发功能验证）

- **诊断结果**：
  - 详细显示各项诊断结果
  - 对异常项提供可视化警告
  - 显示诊断时间和设备信息

- **修复建议**：
  - 针对检测到的问题提供修复建议
  - 支持一键修复功能（适用于常见问题）
  - 提供详细的故障排除指南

## 6. 属性面板设计

属性面板位于工作区下方或右侧，根据当前选中项动态显示相关属性：

### 6.1 设备属性视图

当选中设备列表中的设备时，显示以下属性：

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                                 设备属性                                      │
├──────────────────────────────────────────────────────────────────────────────┤
│ 基本信息                                                                     │
│ 设备名称: USBCANFD-200 #1                  [编辑]                             │
│ 设备类型: USB-CAN 适配器                                                     │
│ 设备ID: SN12345678                                                           │
│ 驱动版本: V2.1.0                                                             │
│ 固件版本: V1.0.3                                                             │
│                                                                              │
│ 硬件信息                                                                     │
│ 硬件版本: V2.0                                                               │
│ 接口类型: USB 3.0                                                            │
│ 通道数量: 2                                                                  │
│ 支持协议: CAN 2.0A/B, CAN FD                                                 │
│                                                                              │
│ 连接信息                                                                     │
│ 连接状态: 已连接                                                             │
│ 连接时间: 2023-11-15 14:30:45                                                │
│ 连接时长: 01:23:45                                                           │
│ 总连接次数: 42                                                               │
└──────────────────────────────────────────────────────────────────────────────┘
```

- **基本信息**：设备名称、类型、ID、驱动和固件版本等
- **硬件信息**：硬件版本、接口类型、通道数量、支持协议等
- **连接信息**：连接状态、连接时间、持续时长、总连接次数等

### 6.2 通道属性视图

当选中通道配置时，显示以下属性：

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                                 通道属性                                      │
├──────────────────────────────────────────────────────────────────────────────┤
│ 基本配置                                                                     │
│ 通道名称: 通道1                            [编辑]                             │
│ 通道类型: CAN 2.0B                                                           │
│ 波特率: 500 Kbps                           ▼                                  │
│ 采样点: 75%                                                                   │
│ 同步跳转宽度: 1                                                                    │
│                                                                              │
│ 过滤器配置                                                                   │
│ 过滤器类型: 关闭                           ▼                                  │
│ 过滤模式: 接收所有帧                       ▼                                  │
│ 验收码: 00000000                                                             │
│ 屏蔽码: FFFFFFFF                                                             │
│ [高级配置...]                                                                │
└──────────────────────────────────────────────────────────────────────────────┘
```

- **基本配置**：通道名称、类型、波特率、采样点等
- **过滤器配置**：过滤器类型、过滤模式、验收码、屏蔽码等
- **高级配置**：提供更多高级参数的配置选项

### 6.3 通信状态属性视图

实时显示通信状态和统计信息：

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                                通信状态                                       │
├──────────────────────────────────────────────────────────────────────────────┤
│ 报文统计                                                                     │
│ 总接收数: 12345                                                              │
│ 总发送数: 54321                                                              │
│ 错误帧数: 0                                                                  │
│ 丢失帧数: 0                                                                  │
│ 当前接收率: 100 帧/秒                                                        │
│ 当前发送率: 50 帧/秒                                                         │
│                                                                              │
│ 错误状态                                                                     │
│ 错误计数器: 0                                                                │
│ 总线负载率: 15%                                                              │
│ 错误状态指示: 主动错误                                                       │
│ 最后错误时间: 无                                                             │
└──────────────────────────────────────────────────────────────────────────────┘
```

- **报文统计**：接收/发送帧数、错误帧/丢失帧数、当前帧速率等
- **错误状态**：错误计数器、总线负载率、错误状态指示等

## 7. 状态栏设计

状态栏位于界面底部，显示系统状态信息和操作提示：

```
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ 状态: 已连接  USBCANFD-200 #1 | 波特率: 500 Kbps | 通道: CH1 | 接收: 12345 | 发送: 54321 | 错误: 0 | 负载率: 15% | 系统就绪     │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 7.1 状态栏内容

- **连接状态**：显示当前设备连接状态，包括设备名称
- **通信参数**：显示当前波特率和使用的通道
- **报文统计**：显示当前接收、发送、错误的报文数量
- **总线负载**：实时显示CAN总线负载率
- **系统提示**：显示系统状态或操作提示信息

### 7.2 状态栏样式

- **高度**：24px
- **背景色**：浅灰色(#F5F5F5)
- **字体**：12px微软雅黑
- **分隔符**：使用竖线("|")分隔不同信息项
- **错误提示**：当发生错误时，相应部分显示红色文字

### 7.3 状态栏交互

- **悬停提示**：鼠标悬停在统计信息上显示详细提示
- **点击操作**：部分信息项支持点击查看详情
- **右键菜单**：提供状态栏配置选项（如显示/隐藏特定信息）

## 7. 交互设计

### 7.1 连接流程
1. 用户从设备列表选择设备
2. 配置通道参数
3. 点击"连接设备"按钮
4. 状态栏显示"连接中"状态
5. 连接成功后，状态栏显示"已连接"状态，设备连接按钮变为"断开连接"
6. 工作区显示连接状态卡片和实时统计信息

### 7.2 断开流程
1. 用户点击"断开连接"按钮
2. 状态栏显示"断开中"状态
3. 断开成功后，状态栏显示"未连接"状态，设备断开按钮变为"连接设备"

### 7.3 错误处理
- 连接失败时，状态栏显示红色错误状态和错误代码
- 弹出错误提示对话框，显示详细错误信息
- 事件日志中记录错误详情

## 8. 视觉设计规范

### 8.1 配色方案
- **主色调**：深蓝色(#0E4C92)
- **辅助色**：
  - 成功色：绿色(#4ECDC4)
  - 警告色：黄色(#FFD166)
  - 错误色：红色(#FF6B6B)
- **中性色**：
  - 背景色：浅灰(#F8F9FA)
  - 文字色：深灰(#343A40)
  - 边框色：中灰(#CED4DA)

### 8.2 控件样式
- **按钮**：圆角矩形，悬停效果明显
- **输入框**：浅灰色背景，聚焦时边框高亮
- **下拉框**：与输入框统一风格
- **状态指示器**：圆形指示灯，颜色鲜明
- **分割线**：细线条，浅灰色

### 8.3 字体规范
- **标题**：微软雅黑，16px，粗体
- **子标题**：微软雅黑，14px，半粗体
- **正文**：微软雅黑，12px，常规
- **状态栏**：微软雅黑，11px，常规

## 9. 响应式设计

### 9.1 窗口大小调整
- 窗口宽度<1024px时：属性面板自动隐藏，提供按钮可快速显示/隐藏
- 窗口宽度<800px时：工作区组件垂直堆叠排列
- 窗口高度<600px时：状态栏自动隐藏，事件日志区域高度自适应

### 9.2 高DPI适配
- 支持100%、125%、150%、200% DPI缩放
- 所有控件和字体使用WPF自动缩放机制
- 图标使用矢量图形，确保缩放清晰度

## 10. 无障碍设计

### 10.1 键盘导航
- 所有按钮和输入框支持Tab键导航
- 连接/断开操作支持快捷键
- 设备列表支持方向键选择

### 10.2 屏幕阅读器支持
- 所有控件添加Accessibility属性
- 状态变化提供朗读提示
- 错误信息提供详细文本描述

### 10.3 颜色对比度
- 文字与背景对比度符合WCAG AA标准
- 状态指示器使用多种指示方式（颜色+图标+文字）

---

**文档版本**: 1.0
**创建日期**: 2024-01-01
**设计作者**: UI设计团队