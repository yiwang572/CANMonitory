# 报文监控功能UI设计文档

## 1. 概述

本设计文档基于CANBusMonitor设计规范，详细描述BMS总线上位机软件中报文监控模块的用户界面设计，包括菜单栏、视图导航栏、工作区、属性面板和状态栏的布局、组件和交互设计。报文监控模块是BMS监控系统的核心组件，负责接收、显示和分析CAN总线上的报文数据。

## 2. 整体布局

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                菜单栏 - 报文监控相关菜单项                         │
├─────────────┬───────────────────────────────────────┬─────────────────────────┤
│             │                                       │                         │
│  导航视图    │             报文监控工作区                │     报文属性面板         │
│             │                                       │                         │
│             │                                       │                         │
└─────────────┴───────────────────────────────────────┴─────────────────────────┘
│                                状态栏 - 监控状态显示                               │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 3. 菜单栏设计

### 3.1 文件菜单（扩展）

```
文件
├── 新建...
├── 打开...
├── 保存
├── ──────────
├── 导入过滤器                 # 报文监控专用菜单项
├── 导出过滤器                 # 报文监控专用菜单项
├── ──────────
├── 导入报文记录               # 报文监控专用菜单项
├── 导出报文记录               # 报文监控专用菜单项
├── ──────────
└── 退出
```

- **导入过滤器**: 导入已保存的过滤器配置
- **导出过滤器**: 导出当前过滤器配置
- **导入报文记录**: 导入历史报文记录文件
- **导出报文记录**: 导出当前报文记录到文件

### 3.2 监控菜单（新增）

```
监控
├── 开始监控                   # 开始接收CAN报文
├── 停止监控                   # 停止接收CAN报文
├── ──────────
├── 清空报文                   # 清空当前报文显示
├── ──────────
├── 暂停显示                   # 暂停报文显示
├── 继续显示                   # 继续报文显示
├── ──────────
└── 报文统计                   # 显示接收统计
```

- **开始监控**: 开始接收和显示CAN报文，快捷键：F5
- **停止监控**: 停止接收CAN报文，快捷键：F6
- **清空报文**: 清空当前显示的报文，快捷键：Ctrl+L
- **暂停显示**: 暂停报文显示，但继续接收，快捷键：F7
- **继续显示**: 继续暂停的报文显示，快捷键：F8
- **报文统计**: 显示报文接收统计信息

### 3.3 过滤器菜单（新增）

```
过滤器
├── 设置过滤器                 # 打开过滤器配置
├── 启用/禁用过滤器            # 切换过滤器状态
└── 保存过滤器                 # 保存过滤器设置
```

- **设置过滤器**: 打开过滤器配置对话框
- **启用/禁用过滤器**: 快速切换过滤器状态
- **保存过滤器**: 保存当前过滤器设置

### 3.4 视图菜单（扩展）

```
视图
├── 报文表格                   # 显示/隐藏表格视图
├── 报文图表                   # 显示/隐藏图表视图
├── 数据趋势                   # 显示/隐藏趋势视图
├── ──────────
├── 属性面板                   # 显示/隐藏右侧属性面板
└── 状态栏                     # 显示/隐藏底部状态栏
```

- **报文表格**: 显示/隐藏报文表格视图
- **报文图表**: 显示/隐藏报文图表视图
- **数据趋势**: 显示/隐藏数据趋势视图
- **属性面板**: 显示/隐藏右侧属性面板
- **状态栏**: 显示/隐藏底部状态栏

## 4. 视图导航栏设计

### 4.1 报文监控模块导航项

在左侧导航视图中，"报文监控"作为单独的功能模块项，图标采用数据监控相关的图形表示。

```
导航视图
├── 设备连接
├── 报文监控                   # 当前模块
│   ├── 报文表格               # 子项
│   ├── 报文图表               # 子项
│   ├── 数据趋势               # 子项
│   └── 过滤器设置             # 子项
├── 报文发送
├── DBC管理
├── OBD诊断
├── 自动化测试
└── 系统设置
```

- **图标**：📊 监控图标
- **文字**：报文监控
- **背景色**：选中时使用主色调(#0E4C92)
- **文字色**：白色
- **悬停效果**：背景色加深10%

### 4.2 导航交互

- 点击主项"报文监控"显示默认的报文表格界面
- 点击子项切换到对应的功能视图
- 当前选中的子项以高亮状态显示（使用主题色#0E4C92）
- 支持通过鼠标悬停显示功能提示
- 提供快速访问常用监控配置的功能
- **文字**：报文监控
- **背景色**：选中时使用主色调(#0E4C92)
- **文字色**：白色
- **悬停效果**：背景色加深10%

### 4.2 导航交互

- 点击主项"报文监控"显示默认的报文表格视图
- 点击子项切换到对应的功能视图
- 当前选中的子项以高亮状态显示（使用主题色#0E4C92）
- 支持通过鼠标悬停显示功能提示
- 提供快速访问常用监控配置的功能

## 5. 工作区设计

工作区根据导航栏选择的子项动态切换内容，主要包括以下视图：

### 5.1 报文表格视图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             报文监控 - 表格视图                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│ [刷新] [清空] [保存] [导入] [筛选] [搜索:_____________] [时间格式:相对时间 ▼] │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 复选框 │ 序号 │ 时间戳 │  ID   │ 类型 │ 格式 │ 长度 │     数据      │  信号  │ 计数器 │
│─────────────────────────────────────────────────────────────────────────────────│
│   □   │  1   │ 0.000  │ 0x123 │ 标准 │ 数据 │  8   │ 11 22 33 44 55 │ 信号值 │   12   │
│   □   │  2   │ 0.012  │ 0x456 │ 扩展 │ 数据 │  6   │ AA BB CC DD EE │ 信号值 │   8    │
│   □   │  3   │ 0.025  │ 0x789 │ 标准 │ 数据 │  4   │ FF 11 22 33   │ 信号值 │   25   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

- **工具栏**: 提供常用操作按钮
  - 刷新、清空、保存、导入、筛选等功能按钮
  - 实时搜索框
  - 时间戳显示格式切换（相对时间/绝对时间）

- **表格列**: 完整展示CAN报文信息
  - 复选框：用于选择报文
  - 序号：自动生成的行号
  - 时间戳：报文接收时间
  - ID：CAN报文ID
  - 类型：标准帧/扩展帧
  - 格式：数据帧/远程帧/错误帧/过载帧
  - 长度：数据长度码
  - 数据：报文数据内容（HEX格式）
  - 信号：解析后的信号值（如果有DBC文件）
  - 计数器：相同ID报文出现次数

- **交互功能**:
  - 右键菜单：复制、保存、查看详情等操作
  - 双击行：显示报文详细信息
  - 表头排序：按列排序功能
  - 列宽调整：拖动表头调整列宽
  - 列显示隐藏：通过右键菜单控制

### 5.2 报文图表视图

图表视图以直观的方式展示报文数据，适合观察数据趋势和异常：

- **图表类型**:
  - 折线图：显示信号随时间的变化趋势
  - 柱状图：比较不同ID的报文数量
  - 散点图：展示报文之间的关系
  - 热力图：展示报文活跃度分布

- **图表配置**:
  - 信号选择：下拉框选择要显示的信号
  - 时间范围：选择图表显示的时间范围
  - 数据刷新：自动/手动刷新选项
  - Y轴范围：自动调整/手动设置
  - 图例显示：显示/隐藏图例

### 5.3 数据趋势视图

趋势视图专注于显示特定信号的值变化趋势：

- **趋势图设计**:
  - 信号选择器：多选框，选择要监控的信号
  - 时间轴：可调整的时间轴
  - Y轴范围：可配置的Y轴范围
  - 网格线：显示/隐藏网格线
  - 数据点标记：显示/隐藏数据点
  - 滚动模式：固定窗口/无限滚动

- **交互功能**:
  - 缩放：鼠标滚轮缩放
  - 平移：拖拽平移视图
  - 测量工具：测量两个时间点之间的变化
  - 标记：在关键点添加标记
  - 导出图表：导出当前图表为图片

### 5.4 报文筛选视图

筛选视图用于配置和管理报文过滤规则：

- **筛选条件配置**:
  - ID过滤器：按CAN ID范围过滤
  - 类型过滤器：按帧类型过滤
  - 方向过滤器：按接收/发送方向过滤
  - 内容过滤器：按数据内容过滤
  - DBC信号过滤器：按解析后的信号值过滤
  - 时间过滤器：按时间范围过滤

- **过滤器管理**:
  - 添加条件：添加新的过滤条件
  - 删除条件：删除现有过滤条件
  - 条件组合：AND/OR逻辑组合多个条件
  - 保存过滤器：保存当前过滤器配置
  - 加载过滤器：加载已保存的过滤器配置
  - 重置过滤器：重置所有过滤条件

## 6. 属性面板设计

右侧属性面板在报文监控模块中显示与当前选中内容相关的详细信息。

### 6.1 报文详情面板

当选中表格中的一条报文时，显示该报文的详细信息：

- **基本信息**：时间戳、ID、类型、格式、长度
- **数据内容**：HEX和ASCII两种格式显示
- **信号解析**：如果有DBC文件，显示解析后的信号值
- **统计信息**：该ID报文的接收次数、频率等

### 6.2 过滤器配置面板

当在筛选视图中时，右侧面板显示更详细的过滤选项：

- **高级过滤条件**：正则表达式过滤
- **过滤规则优先级**：设置过滤规则的优先级
- **过滤统计**：显示过滤后的报文数量和比例
- **过滤历史**：最近使用的过滤条件

### 6.3 视图配置面板

根据当前选中的视图，显示对应的配置选项：

- **表格视图配置**：列显示、排序方式、自动刷新间隔
- **图表视图配置**：图表类型、颜色主题、刷新频率
- **趋势视图配置**：Y轴范围、网格线、数据点样式

## 5. 属性面板设计

右侧属性面板在选中报文或信号时显示，设计如下：

### 5.1 选中项信息
- **标题**：选中项信息
- **显示内容**：根据选中对象类型动态显示
  - 选中报文时：完整报文详情、解码信号列表
  - 选中信号时：信号详细属性、历史值趋势

### 5.2 报文详情
- **标题**：报文详情
- **属性项**：
  - 报文ID：十六进制和十进制显示
  - 报文名称：DBC定义的名称
  - 帧类型：标准帧/扩展帧/CAN FD
  - 数据长度：字节数
  - 循环周期：毫秒
  - 发送节点：节点名称
  - 接收节点：节点列表
  - 原始数据：十六进制和二进制视图

### 5.3 信号详情
- **标题**：信号列表
- **显示方式**：可折叠列表
- **每项包含**：
  - 信号名称
  - 当前值
  - 单位
  - 最小值/最大值
  - 信号描述
  - 起始位/长度
  - 因子/偏移量

### 5.4 过滤器配置
- **标题**：过滤器配置
- **功能**：
  - ID范围过滤
  - 名称过滤
  - 类型过滤
  - 信号值过滤
  - 过滤条件组合
  - 保存/加载过滤器配置

## 6. 状态栏设计

底部状态栏显示报文监控的关键状态信息，设计如下：

### 6.1 左侧区域
- **监控状态**：
  - 颜色：绿色（监控中）/红色（停止）
  - 文字："监控中" 或 "已停止"
- **设备状态**：
  - 格式："设备: [设备名称]"
  - 颜色：绿色（正常）/红色（断开）

### 6.2 中间区域
- **统计信息**：
  - 总报文数：数字显示
  - 速率：报文/秒
  - 过滤后报文数：数字显示
  - 异常报文数：数字显示，红色突出
- **活动过滤器**：
  - 显示当前激活的过滤器名称

### 6.3 右侧区域
- **DBC文件状态**：
  - 显示当前加载的DBC文件名
  - 图标：✅/❌（加载成功/失败）
- **时间统计**：
  - 显示监控持续时间
- **帮助按钮**：
  - 图标：❓
  - 功能：打开监控帮助文档

## 7. 交互设计

### 7.1 监控流程
1. 用户点击"开始监控"按钮或使用快捷键Ctrl+M
2. 状态栏显示"监控中"状态
3. 报文列表开始实时更新
4. 信号面板显示实时信号值
5. 用户点击"停止监控"按钮或使用快捷键Ctrl+S停止监控

### 7.2 报文操作
- **双击报文**：在属性面板显示详细信息
- **右键菜单**：
  - 复制报文数据
  - 过滤该ID的报文
  - 显示关联信号
  - 将报文添加到发送列表
  - 标记/取消标记重要报文

### 7.3 过滤器交互
1. 用户点击"过滤器"按钮或使用快捷键Ctrl+F
2. 弹出过滤器配置对话框
3. 用户设置过滤条件（ID范围、名称包含、信号值等）
4. 应用过滤器后，报文列表实时更新
5. 状态栏显示当前激活的过滤器信息

### 7.4 信号趋势图交互
1. 用户从信号面板选择一个或多个信号
2. 点击右键选择"显示趋势图"
3. 趋势图表区域展开并开始绘制曲线
4. 用户可使用鼠标缩放和拖拽图表
5. 支持调整Y轴范围和时间窗口

## 8. 视觉设计规范

### 8.1 配色方案
- **主色调**：深蓝色(#0E4C92)
- **辅助色**：
  - 成功色：绿色(#4ECDC4)
  - 警告色：黄色(#FFD166)
  - 错误色：红色(#FF6B6B)
  - 信息色：蓝色(#45B7D1)
- **中性色**：
  - 背景色：浅灰(#F8F9FA)
  - 文字色：深灰(#343A40)
  - 边框色：中灰(#CED4DA)
- **特殊编码**：
  - 标准帧：蓝色背景
  - 扩展帧：紫色背景
  - CAN FD帧：橙色背景
  - 异常报文：红色背景

### 8.2 控件样式
- **数据网格**：斑马纹行，悬停高亮
- **按钮**：圆角矩形，图标+文字
- **下拉框**：简洁风格，带搜索功能
- **状态栏**：分隔清晰，颜色编码状态
- **趋势图**：多色曲线，网格背景

### 8.3 字体规范
- **标题**：微软雅黑，16px，粗体
- **子标题**：微软雅黑，14px，半粗体
- **正文**：微软雅黑，12px，常规
- **状态栏**：微软雅黑，11px，常规
- **数据网格**：等宽字体（Consolas），11px，用于ID和数据列

## 9. 响应式设计

### 9.1 窗口大小调整
- 窗口宽度<1280px时：属性面板自动隐藏，提供按钮可快速显示/隐藏
- 窗口宽度<1024px时：信号面板折叠为可展开面板
- 窗口宽度<800px时：趋势图表区域完全隐藏
- 窗口高度<600px时：状态栏自动隐藏，各面板高度自适应

### 9.2 高DPI适配
- 支持100%、125%、150%、200% DPI缩放
- 所有控件和字体使用WPF自动缩放机制
- 图表和图形元素使用矢量渲染

### 9.3 布局优化
- 支持自定义布局，用户可拖拽调整面板大小和位置
- 支持保存/加载不同的布局配置
- 提供预设布局（紧凑模式、全屏监控模式等）

## 10. 性能优化

### 10.1 数据显示优化
- 支持大数据量时的数据分页或虚拟列表
- 提供缓存机制减少重复解码计算
- 可配置的显示更新频率

### 10.2 图表性能
- 使用高效的图表渲染引擎
- 支持数据点压缩和采样
- 提供动态调整数据点密度的选项

### 10.3 响应性能
- 后台线程处理数据接收和解码
- UI更新使用批量处理
- 长时间监控时自动清理旧数据

## 11. 无障碍设计

### 11.1 键盘导航
- 所有功能支持快捷键操作
- 数据网格支持方向键和Tab键导航
- 支持键盘多选和批量操作

### 11.2 屏幕阅读器支持
- 所有控件添加Accessibility属性
- 重要状态变化提供朗读提示
- 数据网格单元格内容可被屏幕阅读器识别

### 11.3 颜色对比度
- 文字与背景对比度符合WCAG AA标准
- 使用多种提示方式（颜色+图标+文字）
- 支持高对比度模式

---

**文档版本**: 1.0
**创建日期**: 2024-01-01
**设计作者**: UI设计团队